<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.rscamper.AppMypageMapper">

	<resultMap type="BoardBookMarkVO" id="BoardBookMarkVOMap">
		<result column="TARGET_NO" property="targetNo"/>
		<result column="TARGET_TYPE" property="targetType"/>
		<result column="USER_UID" property="userUid"/>
		<result column="REG_DATE" property="regDate"/>
	</resultMap>
	
	<resultMap type="CommunityVO" id="CommunityVOMap">
		<result column="BOARD_NO" property="boardNo" />
		<result column="VIEW_CNT" property="viewCnt" />
		<result column="REG_DATE" property="regDate" />
		
		<result column="CATEGORY_NO" property="categoryNo" />
		<result column="CATEGORY_NAME" property="categoryName" />
		
		<result column="USER_UID" property="userUid" />
		<result column="PHOTO_URL" property="photoUrl" />
		<result column="DISPLAY_NAME" property="displayName" />
		<result column="PROVIDER_UID" property="providerUid" />
		<result column="PROVIDER_NAME" property="providerName" />
		<result column="PROVIDER_DISPLAY_NAME" property="providerDisplayName" />
		<result column="PROVIDER_PHOTO_URL" property="providerPhotoUrl" />
		<result column="PROVIDER_EMAIL" property="providerEmail" />
		<result column="BGPHOTO_URL" property="bgPhotoUrl" />
		<result column="PHONE_NUMBER" property="phoneNumber" />
		<result column="WEBSITE_URL" property="websiteUrl" />
		
		<result column="LOCATION_NO" property="locationNo" />
		<result column="LOCATION_NAME" property="locationName" />
		
		<result column="COMMENT_CNT" property="commentCnt"/>
		<result column="LIKE_CNT" property="likeCnt"/>
	</resultMap>
	
	<select id="selectMyBookMark" parameterType="BoardBookMarkVO" resultType="int">
		SELECT *
		FROM BOARD_BOOKMARK_TB
		WHERE TARGET_NO = #{targetNo} AND TARGET_TYPE = 1 AND USER_UID = #{userUid}
	</select>
	
	<select id="selectCommunityList" resultMap="CommunityVOMap" parameterType="hashMap">
		SELECT *, 
			(SELECT COUNT(*) FROM BOARD_COMMENT_TB BC WHERE BC.BOARD_NO=B.BOARD_NO) COMMENT_CNT, 
			(SELECT COUNT(*) FROM BOARD_LIKE_TB LIKETB WHERE LIKETB.TARGET_NO=B.BOARD_NO AND LIKETB.TARGET_TYPE=1) LIKE_CNT
		FROM BOARD_TB B, BOARD_CATEGORY_TB C, USER_TB U, LOCATION_TB L
		WHERE C.CATEGORY_NO = B.CATEGORY_NO 
			AND B.USER_UID = U.USER_UID 
			AND U.LOCATION_NO = L.LOCATION_NO
		ORDER BY BOARD_NO DESC
		LIMIT #{page}, #{count}
	</select>

</mapper>