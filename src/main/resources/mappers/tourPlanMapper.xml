<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.rscamper.TourPlanMapper">

	<resultMap type="TourPlanVO" id="TourPlanVOMap">
		<result property="recordNo" column="RECORD_NO"/>
		<result property="userUid" column="USER_UID"/>
		<result property="departureDate" column="DEPARTURE_DATE"/>
		<result property="arriveDate" column="ARRIVE_DATE"/>
		<result property="title" column="TITLE"/>
		<result property="budGet" column="BUDGET"/>
		<result property="picture" column="PICTURE"/>
		<result property="period" column="PERIOD" />
		<result property="strapline" column="STRAPLINE"/>
		<result property="introduce" column="INTRODUCE"/>
		<result property="regDate" column="REG_DATE"/>
		
		<result property="displayName" column="DISPLAY_NAME"/>
	</resultMap>
	
	<resultMap type="RecordCoverVO" id="RecordCoverMap">
		<result property="coverNo" column="COVER_NO"/>
		<result property="recordNo" column="RECORD_NO"/>
		<result property="realPath" column="REAL_PATH"/>
		<result property="filePath" column="FILE_PATH"/>
		<result property="oriName" column="ORI_NAME"/>
		<result property="fileName" column="FILE_NAME"/>
	</resultMap>
	
	<resultMap type="RecordLocationVO" id="RecordLocationMap">
		<result property="locationNo" column="LOCATION_NO"/>
		<result property="recordNo" column="RECORD_NO"/>
		<result property="title" column="TITLE"/>
		<result property="contentCode" column="CONTENT_CODE"/>
		<result property="imageUrl" column="IMAGE_URL"/>
		<result property="detailDepartureDate" column="DETAIL_DEPARTURE_DATE"/>
		<result property="contentTypeId" column="CONTENT_TYPE_ID"/>
		<result property="departureDate" column="DEPARTURE_DATE"/>
	</resultMap>
	
	<resultMap type="TourPlanSpotVO" id="TourPlanSpotVOMap">
		<result property="publicDataListNo" column="PUBLIC_DATA_LIST_NO" />
	</resultMap>
	
	<select id="selectTourPlanList" resultMap="TourPlanVOMap" parameterType="TourPlanParamVO">
<!-- 			(SELECT COUNT(*) ) LIKE_CNT,  -->
<!-- 			(SELECT COUNT(*) ) COMMENT_CNT,  -->
<!-- 			(SELECT COUNT(*) ) LOCATION_CNT -->
		<![CDATA[
			SELECT R.*, U.DISPLAY_NAME DISPLAY_NAME
			FROM RECORD_TB R, USER_TB U
			WHERE R.USER_UID = U.USER_UID
			AND (DATEDIFF(ARRIVE_DATE, DEPARTURE_DATE) + 1) BETWEEN #{minTripDays} AND #{maxTripDays}
			AND (R.TITLE LIKE '%${word}%' OR R.INTRODUCE LIKE '%${word}%' OR R.STRAPLINE LIKE '%${word}%') 
			AND DATE(R.REG_DATE) >= #{datePeriodDate}
			ORDER BY R.${standard} ${order}
			LIMIT #{startRow}, #{amount}
		]]>
	</select>
	
	<select id="selectTourPlanTotalPages" resultType="int" parameterType="TourPlanParamVO">
		SELECT COUNT(*)
		FROM RECORD_TB
		WHERE (DATEDIFF(ARRIVE_DATE, DEPARTURE_DATE) + 1) BETWEEN #{minTripDays} AND #{maxTripDays}
		AND (TITLE LIKE '%${word}%' OR INTRODUCE LIKE '%${word}%' OR STRAPLINE LIKE '%${word}%') 
		AND DATE(REG_DATE) >= #{datePeriodDate}
	</select>
	
	<insert id="insertTourPlan" parameterType="TourPlanVO">
		INSERT INTO RECORD_TB (USER_UID, TITLE, STRAPLINE, INTRODUCE, DEPARTURE_DATE, ARRIVE_DATE, PERIOD, BUDGET, PICTURE)
		VALUES (#{userUid}, #{title}, #{strapline}, #{introduce}, #{departureDate}, #{arriveDate}, #{period}, 0, 0)
	</insert>
	
	<select id="selectTourPlanSpotTotalPages" parameterType="TourPlanSpotParamVO" resultType="int">
			SELECT COUNT(*)
			FROM PUBLIC_DATA_LIST_TB
			WHERE (TITLE LIKE '%${word}%' OR addr1 LIKE '%${word}%' OR addr2 LIKE '%${word}%')
		<if test="category == 'tour'">
			AND (contentTypeId LIKE '12'
            OR contentTypeId LIKE '14'
            OR contentTypeId LIKE '15'
            OR contentTypeId LIKE '25'
            OR contentTypeId LIKE '28')
		</if>
		<if test="category == 'rest'">
			AND contentTypeId LIKE '15'
		</if>
		<if test="category == 'bed'">
			AND contentTypeId LIKE '32'
		</if>
	</select>
	
	<select id="selectTourPlanSpotList" parameterType="TourPlanSpotParamVO" resultMap="TourPlanSpotVOMap">
			SELECT *
			FROM PUBLIC_DATA_LIST_TB
			WHERE (TITLE LIKE '%${word}%' OR addr1 LIKE '%${word}%' OR addr2 LIKE '%${word}%')
		<if test="category == 'tour'">
			AND (contentTypeId LIKE '12'
            OR contentTypeId LIKE '14'
            OR contentTypeId LIKE '15'
            OR contentTypeId LIKE '25'
            OR contentTypeId LIKE '28')
		</if>
		<if test="category == 'rest'">
			AND contentTypeId LIKE '39'
		</if>
		<if test="category == 'bed'">
			AND contentTypeId LIKE '32'
		</if>
			ORDER BY ${standard} ${order}
			LIMIT #{startRow}, #{amount}
	</select>
	
	
	
	
</mapper>